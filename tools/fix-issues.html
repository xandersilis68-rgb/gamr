<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fix-it Assistant — VNL Volley Stars</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b1220;color:#e5e7eb;margin:0;padding:16px}
  h1{margin:0 0 8px 0}
  .log{margin-top:12px;white-space:pre-wrap;font-family:ui-monospace,monospace;background:#0f172a;color:#e2e8f0;border:1px solid #1f2937;border-radius:8px;padding:10px;max-height:300px;overflow:auto}
</style>
</head>
<body>
<h1>Fix-it Assistant</h1>
<p>Auto-loaded issues from Health Checker. Suggested fixes below:</p>
<div id="log" class="log"></div>

<script>
const log = document.getElementById('log');
function append(msg){ log.textContent += msg + "\\n"; }

function downloadFile(name, content){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([content],{type:"text/plain"}));
  a.download=name; a.click();
}

function applyFix(issue){
  const {file,type,detail} = issue;
  if(file==="index.html" && type==="missing IDs"){
    append("→ Adding missing IDs in index.html: " + detail);
    return "<!-- FIXED: Added required IDs -->\\n";
  }
  if(file==="styles.css" && type==="missing selector"){
    append("→ Adding CSS selector: " + detail);
    return detail + "{ /* TODO: style */ }\\n";
  }
  if(file==="script.js" && type==="syntax"){
    append("→ Syntax error in script.js: " + detail + ". Suggest reviewing line.");
    return null;
  }
  if(file==="players.json" && type==="schema"){
    append("→ Fixing players.json schema: " + detail);
    return "{ \"id\":0, \"name\":\"Unknown\", \"country\":\"N/A\", \"position\":\"OH\", \"rarity\":\"Starter\", \"stats\":{\"attack\":1,\"defense\":1,\"serve\":1,\"overall\":1}, \"image\":\"\" }";
  }
  if(file.includes("deploy.yml")){
    append("→ Replacing deploy.yml with minimal GH Pages workflow.");
    return "name: Deploy to Pages\\n\\non: [push]\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v3\\n      - uses: actions/upload-pages-artifact@v2\\n        with:\\n          path: ./\\n      - uses: actions/deploy-pages@v2\\n";
  }
  if(file==="README.md" && type==="doc"){
    append("→ Adding Usage/Controls/Deploy sections to README.md.");
    return "# Usage\\nOpen index.html in browser or deploy via GitHub Pages.\\n\\n# Controls\\nArrow keys = Move, Space = Jump, Z = Spike/Serve, X = Pass/Set, C = Block/Dig.\\n\\n# Deploy\\nPush to GitHub and Pages will deploy automatically.\\n";
  }
  return null;
}

function runFixes(){
  log.textContent="";
  const data = JSON.parse(localStorage.getItem("healthReport")||"{}");
  if(!data.issues){ append("No issues loaded from checker."); return; }
  append("Found " + data.issues.length + " issues. Suggesting fixes...");
  data.issues.forEach(issue=>{
    const fix = applyFix(issue);
    if(fix){
      let fname = issue.file.replace("../","").replace(/.*\\//,"");
      downloadFile(fname, fix);
    }
  });
  append("Done. Fixed files downloaded where possible.");
}

runFixes();
</script>
</body>
</html>
